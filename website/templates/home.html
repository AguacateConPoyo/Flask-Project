{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="dashboard-container">
    <div class="dashboard-item weight-tracker" id="weightTrackerPreview">
        <h2>Weight Tracker</h2>
        <canvas id="weightChartPreview"></canvas>
    </div>
    <div class="dashboard-item workout-split" id="workoutSplitPreview">
        <h2>Today's Workout</h2>
        <p id="todaysWorkoutPreview">Loading today's workout...</p>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("weightTrackerPreview").onclick = function() {
            window.location.href = "{{ url_for('views.weight_tracker') }}";
        };
        document.getElementById("workoutSplitPreview").onclick = function() {
            window.location.href = "{{ url_for('views.split') }}";
        };

        fetchWeightsPreview();
        fetchTodaysWorkout();
    });

    function fetchWeightsPreview() {
        fetch("{{ url_for('views.get_weights') }}")
            .then(response => response.json())
            .then(data => {
                updateWeightChartPreview(data);
            })
            .catch(error => {
                console.error("Error fetching weights data:", error);
            });
    }

    function updateWeightChartPreview(weights) {
        const ctx = document.getElementById('weightChartPreview').getContext('2d');
        const labels = weights.map(entry => entry.date);
        const data = {
            labels: labels,
            datasets: [{
                label: 'Weight (lbs)',
                data: weights.map(entry => entry.weight),
                backgroundColor: 'rgba(125, 13, 195, 0.2)',  // Purple color
                borderColor: 'rgba(125, 13, 195, 1)',  // Purple color
                borderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        };
        const options = {
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: '#a317be'  // Purple color
                    }
                },
                x: {
                    ticks: {
                        color: '#a317be'  // Purple color
                    }
                }
            }
        };

        if (window.weightChartPreview) {
            if (typeof window.weightChartPreview.destroy === 'function') {
                window.weightChartPreview.destroy();
            }
        }

        window.weightChartPreview = new Chart(ctx, {
            type: 'line',
            data: data,
            options: options
        });
    }

    function fetchTodaysWorkout() {
        fetch("{{ url_for('views.get_todays_workout') }}")
            .then(response => response.json())
            .then(data => {
                document.getElementById('todaysWorkoutPreview').innerText = data.todays_workout;
            })
            .catch(error => {
                console.error("Error fetching today's workout data:", error);
            });
    }
</script>
{% endblock %}
